<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <title>휴가신청서</title>
  <style>
    body {
      background-color: #f8f9fa;
    }

    .container {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-top: 30px;
    }

    .title {
      text-align: left;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .title h4 {
      float: left;
    }

    .btn-container {
      text-align: right;
    }

    .btn-primary {
      margin-left: 10px;
    }

    .modal-content {
      border-radius: 10px;
    }

    .row {
      margin-top: 15px;
      margin-bottom: 15px;
    }

    th {
      text-align: center;
      background-color: #f2f2f2;
    }
    
    td {
      text-align: center;
    }

    .label {
      font-weight: bold;
    }

    .text-right {
      text-align: right;
    }

    /* 아래 간격 조절을 위한 스타일 */
    .table-container {
      margin-bottom: 20px;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script>
    $(document).ready(function(){
      $('.approval-btn').click(function(){
        console.log("test");
        console.log($(this).text());
        console.log($("#reg-id").text());
        console.log($("#denied-content").val());
        $.ajax({
          url:"/vacation/approval",
          type:"post",
          dataType:"json",
          timeout : 5000,
          contentType : 'application/json; charset=utf-8',
          data:JSON.stringify({ 
            "regId": parseInt($("#reg-id").text()),
            "state": $(this).text(),
            "deniedContent": $("#denied-content").val()
          }),
          success: function(data){ 
            console.log(data.resultMessage);
            alert(data.resultMessage);
            location.reload();
          },
          error : function(xhr, ajaxSettings, thrownError) {
            alert(thrownError);
          }
        });
      });
    });
  </script>
</head>
<body>
  <div class="container">
    <div class="title">
      <h4>휴가신청서</h4>
      <div class="btn-container text-right">
        <button th:text="${vacation.state}" type="button" class="btn btn-primary" disabled></button>
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="col-sm-3 label" th:text="부서"/>
      <div class="col-sm-9" th:text="${deptName}"/>
    </div>
    <div class="row">
      <div class="col-sm-3 label" th:text="|직위 / 직책|"/>
      <div class="col-sm-9" th:text="${employee.position}"/>
    </div>
    <div class="row">
      <div class="col-sm-3 label" th:text="신청자"/>
      <div class="col-sm-9" th:text="${employee.name}"/>
    </div>
    <div class="row">
      <div class="col-sm-3 label" th:text="신청일"/>
      <div class="col-sm-9" th:text="${vacation.regDate}"/>
    </div>
    <div class="container table-container"> <!-- 수정된 부분 -->
      <div id="reg-id" th:text="${vacation.regId}" hidden/>
      <table class="table table-bordered">
        <tbody>
          <tr>
            <th th:text="|휴가 유형|"/>
            <td th:text="${vacation.typeId}"/>
          </tr>
          <tr>
            <th th:text="|휴가 기간|"/>
            <td th:text="|${vacation.startDate} ~ ${vacation.endDate}|"/>
          </tr>
          <tr>
            <th th:text="|휴가 일수|"/>
            <td th:text="${vacation.endDate}"/>
          </tr>
          <tr>
            <th th:text="|사유|"/>
            <td th:text="${vacation.content}"/>
          </tr>
          <tr>
            <th th:text="|첨부파일|"/>
            <td th:text="${vacation.endDate}"/>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="row" th:if="${vacation.deniedContent != null}">
      <div class="col-sm-3 label" th:text="|반려 사유|"/>
      <div class="col-sm-9" th:text="${vacation.deniedContent}"/>
    </div>
    <div class="row text-right" th:if="${vacation.state == '결재대기'}">
      <div class="col-sm-12">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#approval" th:text="승인"/>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#cancel" th:text="반려"/>
      </div>
    </div>
  </div>
  <!-- The Modal -->
  <div class="modal fade" id="approval">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">휴가 결재</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <!-- Modal body -->
        <div class="modal-body">
          해당 요청을 승인하시겠습니까?
        </div>
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal" th:text="취소"/>
          <button type="button" class="btn btn-primary approval-btn" th:text="승인"/>
        </div>
      </div>
    </div>
  </div>
  <!-- The Modal -->
  <div class="modal fade" id="cancel">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">휴가 결재</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <!-- Modal body -->
        <div class="modal-body">
          <p>해당 요청을 반려하시겠습니까?</p>
          <div class="form-group">
            <label for="comment" style="font-size: small;">반려 사유:</label>
            <textarea class="form-control" rows="5" id="denied-content" name="text"></textarea>
          </div>
        </div>
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal" th:text="취소"/>
          <button type="button" class="btn btn-primary approval-btn" th:text="반려"/>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
